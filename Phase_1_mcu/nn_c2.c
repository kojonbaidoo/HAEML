#include <stdio.h>
#include <math.h>

// Define the number of neurons in each layer
#define INPUT_SIZE 3
#define HIDDEN_SIZE_1 16
#define HIDDEN_SIZE_2 16
#define OUTPUT_SIZE 3

// Define the activation function
float relu(float x) {
  return fmaxf(0.0, x);
}

// Define the softmax function
void softmax(float *x, int length) {
  float max_val = x[0];
  for (int i = 1; i < length; i++) {
    if (x[i] > max_val) {
      max_val = x[i];
    }
  }

  float sum = 0.0;
  for (int i = 0; i < length; i++) {
    x[i] = expf(x[i] - max_val);
    sum += x[i];
  }

  for (int i = 0; i < length; i++) {
    x[i] /= sum;
  }
}

void predict(float x, float y, float z) {
  // Define the input array
  float input[INPUT_SIZE] = {x,y,z};

  // Define the weights and biases for the neural network
  float weights_1[INPUT_SIZE][HIDDEN_SIZE_1] = {
    {-0.446940159565331,0.272376518427189,-0.805133871867814,-0.474341747695588,-0.594756433247355,-2.35092788714498,-0.852944632872311,0.23815943315168,0.255072415871753,1.80047244756103,-1.18692626353998,0.71654462113921,1.74237814237155,0.0897144360751598,-0.155182701356012,1.95564857652032},
    {0.0503051742020588,0.529389059425728,-2.66255388542537,0.784184866128361,1.25810757182344,-1.33101862652572,1.06130723627218,0.868827144008632,-0.566061085550702,-0.800898129760995,2.31366882500829,-0.215453067030168,1.08740016279188,0.0999463305426775,0.143644397197579,-0.269982567647195},
    {0.895000661431211,1.91844527775307,-0.774221243724805,-1.29021967656508,-0.174527172645466,0.732893908572609,1.64880325552852,-2.82015153278886,-0.182629058241287,-0.935690479211973,-1.05934080639216,-0.357226894113805,-1.37880773958601,-0.2121376497116,0.361872334644592,2.52074828831962}
  };

  float biases_1[HIDDEN_SIZE_1] = {
    -0.526462055302771,
    0.502184837564316,
    0.0774149774038273,
    1.01486657995262,
    0.385183692290811,
    1.05833353822702,
    -0.443033245977843,
    1.60684136239646,
    -0.44537662031255,
    0.741677272839251,
    1.07553634064502,
    -0.379414610229653,
    0.902570632134698,
    0.763572258831601,
    -0.59163745231196,
    -0.169414691402274
  };

  float weights_2[HIDDEN_SIZE_1][HIDDEN_SIZE_2] = {
    {-0.191484236554705,-0.382827298461635,-0.990854821746329,0.00668288588965629,0.744343255822373,-0.652175852379715,-0.214397481181533,0.300029998267219,-0.897247780185256,-0.61909333777272,-0.69549617059207,-0.0908846159775241,-0.763684487859377,0.268836316858878,0.855332299046876,0.757280358441161},       
    {-0.563807914120118,1.7849005692076,-0.600359282237375,-0.659578750711646,0.162743440702629,-0.839320525678303,0.835967130669437,0.0342169394155577,0.199644973288948,-0.27499393137907,0.937638298148413,-0.758368048499781,0.470704698831836,-0.215241758424273,0.624357208613489,-1.25664552592384},
    {1.2297278967416,0.392924499102983,-0.82216572596066,0.0505515049292857,0.0983917073213002,1.84002363700893,-0.485395685232615,0.94125577130858,-0.351676970527174,1.13626142269136,-1.44727611258456,-0.805322708258299,0.407105018312737,1.30398428878358,-0.904127873899716,0.835631722999656},
    {1.03103904551214,-0.890607105773752,-0.439550511329487,-0.559076122441814,-0.907831093627052,0.578763217519302,-0.980233314115568,0.621553869215724,0.851112788905274,0.22707857842756,0.654266177186554,-0.7789696193736,-0.761127671615675,-0.286945322257673,0.236762176890637,0.497830744356568},
    {-0.82761387401679,0.205982879743277,-0.253031851783709,0.14027752620382,-0.346998019472042,0.380371021513626,0.437899307242546,-0.354545913739466,0.0259035860015268,-1.00382529815741,0.0498015833514871,0.23503353494938,0.00525411171418992,-0.321742825590709,-0.0806384004912636,1.00556907535554},
    {0.93945632386128,-1.04571394191714,-0.137660843739404,1.61686843605944,0.713883430158192,0.965693970701341,-0.998590664970257,1.25315496631887,-0.493564302948042,-0.644921743575788,0.562762750372259,0.607734906712698,0.736187458269722,0.703521759060039,-0.638811536758983,-2.03378796188495},
    {0.0944551329911518,1.74430131776591,-0.465720474257123,-0.358233352962655,-0.636737241498687,0.541224970063016,-0.136891237111742,1.12207758410899,0.441722969792257,-0.723192450060928,-0.013256420575192,0.225398099596741,-0.353613755105217,0.99117155025474,-0.798241318431292,0.606558737712693},
    {-0.200892932358581,-1.46217384496773,0.396977498450231,-0.236473880874895,-0.787941541951337,-1.00629501607508,0.126793432335047,0.783843230473979,-0.204614027500226,-0.463016940640224,-0.710056197291305,-0.0525191501257678,-0.932056825680688,0.398020257098236,0.508916488379272,2.62425251473531},
    {-0.410430800540764,-0.543132846689938,0.784845434098563,0.1026166323278,-0.248359655669357,-0.256338356335916,0.810173609211111,-0.61143699940945,-0.43618240964146,0.30073790200547,0.0362893828364315,0.73985312550548,-0.0101786169680256,0.266166536116769,-0.12032436389432,0.654325960882697},
    {-0.451256257621061,-0.00417061045237551,-0.822580039683333,-0.0330443541206239,-0.395571679101402,-0.816909489337103,-0.560927536282776,0.227475432262295,-1.18348436698191,1.80037738728189,0.301343305201557,0.673372449614874,-0.0903460783041563,-0.411192315213696,-0.794842664316539,0.488695498350341},     
    {-0.299423978293865,-1.28825054422564,-0.685732730459155,0.32650796486435,-0.447571200201225,0.806597267620027,-0.761881508360997,-0.347832131097802,1.60918371099431,-0.948848038227536,1.18037876024002,-0.0490689088995124,-0.056082538553481,0.906168918830044,0.712107100179208,1.54046237876266},
    {0.0719809826410677,0.539552112379671,0.549372524770778,0.512599678047568,0.229428053260136,0.672243042250944,-0.448203415652995,-0.0688947172181545,-0.315387424795334,0.0280267688601014,0.810958518858669,0.0894792514197638,-0.23277241991145,0.946737992528276,-0.985751380126794,-0.515840440754018},
    {-0.828640002588641,0.0878289119254004,0.581752939601449,-0.918052495073253,-0.426996400538873,-1.04477030333257,0.716793232491993,0.528787665908071,1.14736126877402,1.02834694869904,0.0344038243061709,-0.998866878141702,-0.757001890595414,-0.420729160422559,1.17347475617008,1.82022272175222},
    {0.663672633570311,0.639914330901471,-0.405961599527097,0.715026030561059,-0.40165911800544,0.306034260173476,-0.00635770289426536,0.277829175782754,-0.460663071697427,-0.0346597627144842,0.817435813435946,-0.859758542888764,-0.593714890944993,-0.720004323647205,0.0979523186067213,0.331558781120868},       
    {-0.482887367122389,-0.983284255583939,-0.0719939482381062,-0.707677959215506,-0.550961850704571,-0.928283634123306,0.885078473779911,-0.332155792085698,0.721406284788295,-0.999374497950813,-0.473055747424553,-0.928038017135655,0.575967595571476,0.0811319322390709,-0.263077846362126,-0.907115835167708},    
    {-0.701473637087828,2.29153466413945,0.146285248240175,-1.13439823391499,-0.9230442913555,-1.45578662111387,0.680837410774052,-0.472930349654633,-0.514337433325259,0.697986388195099,0.448777677142348,-0.506030095255299,0.958745704995696,0.104814508665203,0.192670098127245,-1.16064232037864}
  };

  float biases_2[HIDDEN_SIZE_2] =  {-0.285355805591819,
    0.271500870671329,
    0.0115690038198708,
    0.821318348558945,
    0.544016231002046,
    0.667869413697664,
    -0.173638241206801,
    0.0906926146695117,
    -0.277941438287848,
    0.67552356272145,
    -0.207824199209766,
    -0.260621463666912,
    -0.0938540798497278,
    0.468536324734242,
    0.114559219751653,
    0.0184419409444323
};

  float weights_3[HIDDEN_SIZE_2][OUTPUT_SIZE] = {
    {-0.452567747730925,0.229086514695851,1.52399650564004},
    {-2.79915907947352,2.20801902446852,1.47033063845408},
    {0.249626437545573,0.788912277659577,0.427984881344033},
    {1.0692701627777,-0.921148120962398,1.14449340356773},
    {-0.2826078197705,0.589541463812699,0.606278639979359},
    {-2.39459870137316,-0.256020531342615,2.09629616553491},
    {0.261933762475794,-0.819926025009314,-0.402276420113305},
    {-0.10525480011121,1.21302407736733,-0.657046124323765},
    {-1.68486498278658,0.31809784483041,0.950507980789749},
    {-2.05899315879435,-0.612038658069901,1.69721714943377},
    {1.25494948572337,-1.23861116534606,-0.226580480058207},
    {0.957206432443479,-0.3610496068149,-0.806439229748239},
    {-1.43737127176013,0.41242918530447,-0.150432673637424},
    {-0.882228398172654,1.13983031791972,0.464893197908041},
    {0.481990374163908,-1.17740419937123,0.213934303186166},
    {-3.53410625780755,2.00566041671414,1.37797307177629}
  };
  
  float biases_3[OUTPUT_SIZE] = {-0.0314707235439303, 0.605064426845519, 0.0390738876578246};

  // Perform the forward pass through the neural network
  float hidden_1[HIDDEN_SIZE_1];
  for (int i = 0; i < HIDDEN_SIZE_1; i++) {
    float sum = biases_1[i];
    for (int j = 0; j < INPUT_SIZE; j++) {
      sum += input[j] * weights_1[j][i];
    }
    hidden_1[i] = relu(sum);
  }

  float hidden_2[HIDDEN_SIZE_2];
  for (int i = 0; i < HIDDEN_SIZE_2; i++) {
    float sum = biases_2[i];
    for (int j = 0; j < HIDDEN_SIZE_1; j++) {
      sum += hidden_1[j] * weights_2[j][i];
    }
    hidden_2[i] = relu(sum);
  }

  float output[OUTPUT_SIZE];
  for (int i = 0; i < OUTPUT_SIZE; i++) {
    float sum = biases_3[i];
    for (int j = 0; j < HIDDEN_SIZE_2; j++) {
      sum += hidden_2[j] * weights_3[j][i];
    }
    output[i] = sum;
  }
  softmax(output, OUTPUT_SIZE);

  // Print the output probabilities
  printf("Output probabilities: [");
  for (int i = 0; i < OUTPUT_SIZE; i++) {
    printf("%f", output[i]);
    if (i < OUTPUT_SIZE - 1) {
      printf(", ");
    }
  }
  printf("]\n");
}

int main(){
    //vertical: 1
    predict(-472,-466,8434);
    predict(-56,205,8490);
    predict(211,672,8308);
    predict(678,1364,7614);
    predict(750,1693,6333);
    predict(926,1722,5161);
    predict(1050,1701,3942);
    predict(1059,1598,2473);
    predict(887,1396,849);
    predict(592,1238,-583);
    printf("\n");

    //still: 0
    predict(4,8,4165);
    predict(-5,6,4176);
    predict(-1,6,4174);
    predict(0,2,4165);
    predict(-4,2,4171);
    predict(-5,2,4161);
    predict(-2,0,4160);
    predict(-5,-1,4157);
    predict(-4,-2,4160);
    predict(-3,0,4173);
    printf("\n");

    //horizontal: 2
    predict(-68,144,3467);
    predict(1372,833,4822);
    predict(1336,922,5087);
    predict(1195,673,4947);
    predict(1013,342,4568);
    predict(809,-20,4125);
    predict(603,-469,3630);
    predict(675,-731,3263);
    predict(904,-594,3433);
    predict(1151,-269,4038);
return 0;
}